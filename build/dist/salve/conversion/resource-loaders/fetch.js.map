{"version":3,"file":"fetch.js","sourceRoot":"","sources":["../../../../../lib/salve/conversion/resource-loaders/fetch.ts"],"names":[],"mappings":";;;;AASA,+CAA+C;AAC/C,IAAI,OAAO,KAAK,KAAK,WAAW,EAAE;IAChC,MAAM,IAAI,KAAK,CAAC,sDAAsD,CAAC,CAAC;CACzE;AAED,MAAa,aAAa;IACxB,YAAqB,GAAQ,EAAW,QAAkB;QAArC,QAAG,GAAH,GAAG,CAAK;QAAW,aAAQ,GAAR,QAAQ,CAAU;IAAG,CAAC;IAExD,OAAO;;YACX,OAAO,IAAI,CAAC,QAAQ,CAAC,IAAI,EAAE,CAAC;QAC9B,CAAC;KAAA;CACF;AAND,sCAMC;AAED;;;;;GAKG;AACH,MAAa,mBAAmB;IACxB,IAAI,CAAC,GAAQ;;YACjB,IAAI,GAAG,CAAC,QAAQ,KAAK,OAAO,EAAE;gBAC5B,MAAM,IAAI,KAAK,CAAC,8CAA8C,CAAC,CAAC;aACjE;YAED,MAAM,QAAQ,GAAG,MAAM,KAAK,CAAC,GAAG,CAAC,QAAQ,EAAE,CAAC,CAAC;YAC7C,IAAI,CAAC,QAAQ,CAAC,EAAE,EAAE;gBAChB,MAAM,IAAI,KAAK,CAAC,mBAAmB,GAAG,EAAE,CAAC,CAAC;aAC3C;YAED,OAAO,IAAI,aAAa,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAC;QAC1C,CAAC;KAAA;CACF;AAbD,kDAaC","sourcesContent":["/**\n * A resource loader that loads resources using ``fetch``.\n *\n * @author Louis-Dominique Dubeau\n * @license MPL 2.0\n * @copyright Mangalam Research Center for Buddhist Languages\n */\nimport { Resource, ResourceLoader } from \"../resource-loader\";\n\n// tslint:disable-next-line:no-typeof-undefined\nif (typeof fetch === \"undefined\") {\n  throw new Error(\"trying to load the fetch loader when fetch is absent\");\n}\n\nexport class FetchResource implements Resource {\n  constructor(readonly url: URL, readonly response: Response) {}\n\n  async getText(): Promise<string> {\n    return this.response.text();\n  }\n}\n\n/**\n * A resource loader that loads resources using ``fetch``. It can only be used\n * in an environment where ``fetch`` is native or provided by a polyfill.\n *\n * This loader does not allow loading from ``file://``.\n */\nexport class FetchResourceLoader implements ResourceLoader<FetchResource> {\n  async load(url: URL): Promise<FetchResource> {\n    if (url.protocol === \"file:\") {\n      throw new Error(\"this loader cannot load from the file system\");\n    }\n\n    const response = await fetch(url.toString());\n    if (!response.ok) {\n      throw new Error(`unable to fetch ${url}`);\n    }\n\n    return new FetchResource(url, response);\n  }\n}\n"]}